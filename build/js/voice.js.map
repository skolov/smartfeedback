{"version":3,"sources":["voice.js"],"names":["navigator","mediaDevices","getUserMedia","audio","then","stream","mediaRecorder","MediaRecorder","document","querySelector","addEventListener","getElementById","hidden","style","display","innerHTML","clockform","start","findTIME","audioChunks","event","push","data","stop","send","FormData","append","sendVoice","audioBlob","Blob","type","fd","sendTempVoice","form","fetch","method","body","promise","ok","json","response","location","href","url","createElement","src","controls","autoplay","appendChild","initPlayer","trim","string","replace","init","startDate","clocktimer","clearFields","clearTimeout","clock","value","label","startTIME","thisDate","Date","t","getTime","ms","Math","floor","s","m","h","setTimeout","str","audioHolder","playBtn","timer","timeLine","timeLinePointer","timeLineBack","toggleFlag","onloadedmetadata","onclick","play","console","log","getNormalDate","duration","pause","inputTime","tempData","arr","split"],"mappings":"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","sourcesContent":["navigator.mediaDevices.getUserMedia({ audio: true}).then(stream => {\n\tconst mediaRecorder = new MediaRecorder(stream);\n\t\n\n\tdocument.querySelector('#delete').addEventListener('click', function(){\n\t\tdocument.getElementById('start').hidden = false;\n\t\tdocument.getElementById('send').hidden = true;\n\t\tdocument.querySelector('div.mobile__record-ico-holder').style.display = 'none'; \n\t\tdocument.querySelector('div.mobile__record-form-holder').style.display = 'none';\n\t\tdocument.querySelector('div.mobile__record-player-holder').style.display = 'none';\n\t\tdocument.querySelector('div.mobile__record-text').style.display = 'block';\n\t\tdocument.querySelector('#messages').innerHTML = '';\n\t\tdocument.clockform.hidden = true;\n\t\tdocument.getElementById('delete').hidden = true;\n\t});\n\n\n    document.querySelector('#start').addEventListener('touchstart', function(){\n        mediaRecorder.start();\n\t\tdocument.getElementById('send').hidden = true;\n\t\tdocument.querySelector('div.mobile__record-ico-holder').style.display = 'flex';\n\t\tdocument.querySelector('div.mobile__record-form-holder').style.display = 'flex';\n\t\tdocument.querySelector('div.mobile__record-text').style.display = 'none';\n\t\tdocument.querySelector('#messages').innerHTML = '';\n\t\tdocument.clockform.hidden = false;\n\t\tfindTIME();\n\t\t\n    });\n    let audioChunks = [];\n    mediaRecorder.addEventListener(\"dataavailable\",function(event) {\n        audioChunks.push(event.data);\n    });\n\n    document.querySelector('#start').addEventListener('touchend', function(){\n        mediaRecorder.stop();\n\t\tdocument.getElementById('start').hidden = true;\n\t\tdocument.getElementById('send').hidden = false;\n\t\tdocument.getElementById('delete').hidden = false;\n\t\tdocument.querySelector('div.mobile__record-form-holder').style.display = 'none';\n\t\tdocument.querySelector('div.mobile__record-player-holder').style.display = 'flex';\n\t\tdocument.clockform.hidden = false;\n\t\t\n\t\tfindTIME();\n    });\n\n\tdocument.querySelector('#send').addEventListener('click', function(){\n\t\tlet send = new FormData();\n\t\tsend.append('action', 'filesUploaded');\n\t\tsend.append('type', 'sendVoice');\n\t\t\n\t\tsendVoice(send);\n\t\t\n\t});\n\t\n\n    mediaRecorder.addEventListener(\"stop\", function() {\n        const audioBlob = new Blob(audioChunks, {\n            type: 'audio/wav'\n        });\n\n        let fd = new FormData();\n        fd.append('voice', audioBlob);\n\t\tfd.append('action', 'filesUploaded');\n\t\tfd.append('type', 'updateTempVoice');\n        sendTempVoice(fd);\n        audioChunks = [];\n    });\n});  \n\nasync function sendVoice(form) {\n    let promise = await fetch(\"/ajax.php\", {\n        method: 'POST',\n        body: form});\n    if (promise.ok) {\n\t\tlet response =  await promise.json();\n\t\t\n\t\tdocument.location.href = response.url;\n\t}\n}\n                    \nasync function sendTempVoice(form) {\n    let promise = await fetch(\"/ajax.php\", {\n        method: 'POST',\n        body: form});\n    if (promise.ok) {\n\t\tlet response =  await promise.json();\n\t\t\n\n        let audio = document.createElement('audio');\n        audio.src = response.data;\n        audio.controls = true;\n        audio.autoplay = false;\n\t\tdocument.querySelector('#messages').innerHTML = '';\n\t\tdocument.querySelector('#messages').appendChild(audio);\n\t\tinitPlayer();\n\t\t\n    }\n}\n\t\t\t\t\t\nfunction trim(string) { return string.replace (/\\s+/g, \" \").replace(/(^\\s*)|(\\s*)$/g, ''); }\nvar init=0;\nvar startDate;\nvar clocktimer;\n\nfunction clearFields() {\n\tinit = 0;\n\tclearTimeout(clocktimer);\n\tdocument.clockform.clock.value='00:00';\n\tdocument.clockform.label.value='';\n}\n\nfunction startTIME() { \n\tvar thisDate = new Date();\n\tvar t = thisDate.getTime() - startDate.getTime();\n\tvar ms = t%1000; t-=ms; ms=Math.floor(ms/10);\n\tt = Math.floor (t/1000);\n\tvar s = t%60; t-=s;\n\tt = Math.floor (t/60);\n\tvar m = t%60; t-=m;\n\tt = Math.floor (t/60);\n\tvar h = t%60;\n\tif (h<10) h='0'+h;\n\tif (m<10) m='0'+m;\n\tif (s<10) s='0'+s;\n\tif (ms<10) ms='0'+ms;\n\tif (init==1) document.clockform.clock.value = m + ':' + s;\n\tclocktimer = setTimeout(\"startTIME()\",10);\n}\n\nfunction findTIME() {\n\tif (init==0) {\n\t\tstartDate = new Date();\n\t\tstartTIME();\n\t\tinit=1;\n\t} \n\telse {\n\t\tvar str = trim(document.clockform.label.value);\n\t\tclearFields();\n\t}\n}\n\n\n\nfunction initPlayer() {\n\tlet audioHolder = document.querySelector('#messages'),\n\t\taudio = audioHolder.querySelector('audio'),\n\t\tplayBtn = document.querySelector('button.mobile__record-play-btn'),\n\t\ttimer = document.querySelector('div.mobile__record-timer'),\n\t\ttimeLine = document.querySelector('div.mobile__record-player-line'),\n\t\ttimeLinePointer = document.querySelector('span.mobile__record-player-line-pointer'),\n\t\ttimeLineBack = document.querySelector('div.mobile__record-player-line-back');\n\n\n\tlet toggleFlag = true;\n\n\tif(\n\t\taudio !== null &&\n\t\tplayBtn !== null &&\n\t\ttimer !== null &&\n\t\ttimeLine !== null &&\n\t\ttimeLineBack !== null &&\n\t\ttimeLinePointer !== null\n\t) {\n\t\taudio.onloadedmetadata = () => {\n\t\t\tplayBtn.onclick = () => {\n\t\t\t\tif (toggleFlag) {\n\t\t\t\t\taudio.play();\n\t\t\t\t\tconsole.log('play')\n\t\t\t\t\ttimer.innerHTML = getNormalDate(audio.duration);\n\t\t\t\t} else {\n\t\t\t\t\taudio.pause();\n\t\t\t\t\tconsole.log('pause')\n\t\t\t\t\ttimer.innerHTML = getNormalDate(audio.duration);\n\t\t\t\t} \n\t\t\t\ttoggleFlag = !toggleFlag;\n\t\t\t}\n\t\t}\n\t}\n\t\n}\n\n\nfunction getNormalDate(inputTime) {\n\n\tlet tempData = '02:22:00',\n\t\tarr = tempData.split('.');\n\n\t/*\n\n\tif (inputTime !== Infinity) {\n\t\tconsole.log(typeof(inputTime));\n\t\tconsole.log(inputTime);\n\t\tconsole.log(inputTime.toString().split('.'))\n\t\t\n\t\tlet arr = toString(inputTime).split('.');\n\t\n\t\tif(arr[0] < 10) arr[0] = '0' + arr[0];\n\t\tarr[1] = Math.floor(arr[1]/100);\n\t\tif(arr[1] < 10) arr[1] = '0' + arr[1];\n\n\n\t\tconsole.log(arr[0] + ':' + arr[1]);\n\t\t\n\t}\n\n\t*/\n\n\n\t\n\treturn '00:00';\n}"],"file":"voice.js"}